<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>URL Manager</title>
  <link href="./bootstrap-5.3.2-dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="./mdb/css/mdb.min.css" rel="stylesheet">
  <link href="./fontawesome-free-6.5.1-web/css/all.css " rel="stylesheet">
</head>

<body>
    <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom box-shadow fixed-top">
        <img src="./logo.png"/><h5 class="my-0 mx-3 mr-md-auto font-weight-normal">Video Uploader to Cloudflare R2</h5>
        <button type="button" class="btn btn-outline-primary btn-floating left" data-mdb-ripple-init data-mdb-ripple-color="dark" data-bs-toggle="modal" data-bs-target="#staticBackdrop" style="position: absolute; right: 20px;">
            <i class="fas fa-gear"></i>
        </button>
    </div>

    <div style="margin-top: 100px;"></div>
    <div class="row mx-1">
        <div class="col-md-8">
            <div class="card border border-info shadow-0 mb-3" style="min-height: 370px;">
                <div class="card-header text-primary">Summary</div>
                <div class="card-body mt-3">
                    <div class="row">
                        <div class="col border-end">
                            <div class="mx-2 mb-3"><h6 class="text-warning">Animes_Video</h6></div>
                            <div class="mx-2 text-end"><p id="anime1">New item  : 0</p></div>
                            <div class="mx-2 text-end"><p id="anime2">Completed : 0</p></div>
                            <div class="mx-2 text-end"><p id="anime3">All Episodes:0</p></div>
                        </div>
                        <div class="col border-end">
                            <div class="mx-2 mb-3"><h6 class="text-success">Series_Video</h6></div>
                            <div class="mx-2 text-end"><p id="serie1">New item  : 0</p></div>
                            <div class="mx-2 text-end"><p id="serie2">Completed : 0</p></div>
                            <div class="mx-2 text-end"><p id="serie3">All Episodes: 0</p></div>
                        </div>
                        <div class="col">
                            <div class="mx-2 mb-3"><h6 class="text-primary">Movies_Video</h6></div>
                            <div class="mx-2 text-end"><p id="movie1">New item : 0</p></div>
                            <div class="mx-2 text-end"><p id="movie2">Completed : 0</p></div>
                            <div class="mx-2 text-end"><p id="movie3">All Episodes: 0</p></div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary mt-3" id="start_btn" data-mdb-ripple-init data-mdb-ripple-color="dark" style="position: absolute; right: 10px; bottom: 10px;">
                        Start Process
                    </button>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border border-success shadow-0 mb-3" style="min-height: 370px;">
                <div class="card-header text-success">Process Status</div>
                <div class="card-body mt-3">
                    <div class="mx-2"><p id="count_animes">Complete of Anime : 0</p></div>
                    <div class="mx-2"><p id="count_series">Complete of Series : 0</p></div>
                    <div class="mx-2"><p id="count_movie">Complete of Movie : 0</p></div>
                    <button type="button" class="btn btn-primary btn-floating left" id="stop_btn" data-mdb-ripple-init data-mdb-ripple-color="dark" style="position: absolute; right: 10px; bottom: 10px;">
                        <i class="fas fa-pause"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="mx-3">
        <div class="card border border-success shadow-0 mb-3" style="min-height: 200px;">
            <div class="card-body">
                <div class="mx-3 text-primary"><p id="process-header">Preparing...</p></div>
                <div class="mx-3">
                    <div class="row">
                        <div class="col-md-11">
                            <p id="from_url"></p>
                        </div>
                        <div class="spinner-border text-primary" role="status" id="spinner" style="position: absolute; right: 10px; bottom: 10px;">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="progress mx-2 fixed-bottom mb-2" style="height: 20px;">
        <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id="progress-bar">0%</div>
    </div>
<div class="modal fade" id="staticBackdrop" tabindex="-1" data-bs-backdrop="static" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-primary">
        <h5 class="modal-title text-white" id="staticBackdropLabel">Setting</h5><button class="btn p-1" type="button" data-bs-dismiss="modal" aria-label="Close"><span class="fas fa-times fs--1 text-white"></span></button>
      </div>
      <div class="modal-body">
        <div class="border-bottom">
            <div class="row mb-3">
                <label for="Host" class="col-sm-2 col-form-label">Host</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="Host">
                </div>
              </div>
              <div class="row mb-3">
                <label for="User" class="col-sm-2 col-form-label">User</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="User">
                </div>
              </div>
              <div class="row mb-3">
                <label for="password" class="col-sm-2 col-form-label">Password</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="password">
                </div>
              </div>
              <div class="row mb-3">
                <label for="database" class="col-sm-2 col-form-label">Database</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="database">
                </div>
              </div>
        </div>
        <div class="mt-3">
            <div class="row mb-3">
                <label for="accessKey" class="col-sm-2 col-form-label">AccessKey</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="accessKey">
                </div>
              </div>
              <div class="row mb-3">
                <label for="SecretKey" class="col-sm-2 col-form-label">SecretKey</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="SecretKey">
                </div>
              </div>
              <div class="row mb-3">
                <label for="AccountId" class="col-sm-2 col-form-label">AccountId</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="AccountId">
                </div>
              </div>
        </div>
      </div>
      <div class="modal-footer"><button class="btn btn-primary" type="button" id="set_btn" data-bs-dismiss="modal">Save</button><button class="btn btn-outline-primary" type="button" data-bs-dismiss="modal">Cancel</button></div>
    </div>
  </div>
</div>
      

  <script>
    const electron = require('electron');

    const { ipcRenderer } = electron;
    //send data from this page into electron

    document.getElementById("start_btn").style.display = "none";
    document.getElementById("stop_btn").style.display = "none";



    document.getElementById("start_btn").addEventListener('click', () => {
        ipcRenderer.send('start');
        document.getElementById("start_btn").style.display = "none";
        document.getElementById("stop_btn").style.display = "block";
    });

    document.getElementById("stop_btn").addEventListener('click', () => {
        ipcRenderer.send('stop');
        document.getElementById("start_btn").style.display = "block";
        document.getElementById("start_btn").innerHTML = "Resume Process";
        document.getElementById("stop_btn").style.display = "none";
    });

    document.getElementById("set_btn").addEventListener('click', () => {
        ipcRenderer.send('set',
            document.getElementById("Host").value,
            document.getElementById("User").value,
            document.getElementById("password").value,
            document.getElementById("accessKey").value,
            document.getElementById("SecretKey").value,
            document.getElementById("AccountId").value,
            document.getElementById("database").value
        );
        alert("Save Successed. This setting is available after a restart.");
    });

    // retrieve data from electeon into this page
    ipcRenderer.on('success', (event, str) => {
        let integer = parseInt(str);
        var progress_bar = document.getElementById('progress-bar');
        progress_bar.innerHTML = integer + "%";
        progress_bar.style.width = integer + "%";
    });

    ipcRenderer.on('animecount', (event, arr) => {
        document.getElementById('anime1').innerHTML="New item : "+arr.new;
        document.getElementById('anime2').innerHTML="Completed : "+arr.completed;
        document.getElementById('anime3').innerHTML="All Episodes : "+arr.all;
    });

    ipcRenderer.on('seriecount', (event, arr) => {
        document.getElementById('serie1').innerHTML="New item : "+arr.new;
        document.getElementById('serie2').innerHTML="Completed : "+arr.completed;
        document.getElementById('serie3').innerHTML="All Episodes : "+arr.all;
    });

    ipcRenderer.on('moviecount', (event, arr) => {
        document.getElementById('movie1').innerHTML="New item : "+arr.new;
        document.getElementById('movie2').innerHTML="Completed : "+arr.completed;
        document.getElementById('movie3').innerHTML="All Episodes : "+arr.all;
    });

    ipcRenderer.on('show_message', (event, str) => {
        document.getElementById('from_url').innerHTML=str
    });

    ipcRenderer.on('show_header', (event, str) => {
        document.getElementById('process-header').innerHTML=str
    });

    ipcRenderer.on('setCountAnime', (event, str) => {
        document.getElementById('count_animes').innerHTML="Complete of Anime : " + str;
    });

    ipcRenderer.on('setCountSeries', (event, str) => {
        document.getElementById('count_series').innerHTML="Complete of Series : " + str;
    });

    ipcRenderer.on('setCountMovies', (event, str) => {
        document.getElementById('count_movie').innerHTML="Complete of Movies : " + str;
    });
    ipcRenderer.on('completed loaded', ()=>{
        document.getElementById("start_btn").style.display = "block";
        document.getElementById('process-header').innerHTML="Completed loaded"
        document.getElementById("spinner").style.display = "none";
    });
    ipcRenderer.on('hide_spinner', ()=>{
        document.getElementById("spinner").style.display = "none";
    });
    ipcRenderer.on('show_spinner', ()=>{
        document.getElementById("spinner").style.display = "block";
    });
    // You can also require other files to run in this process
    require('./renderer.js')
  </script>
  <script src="./bootstrap-5.3.2-dist/js/bootstrap.min.js"></script>
  <script src="./mdb/js/mdb.es.min.js"></script>
</body>

</html>